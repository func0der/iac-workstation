---

- name: Setup Development systems
  hosts: all
  tasks:
    - name: Update apt and all packages
      become: true
      block:
        - name: Update cache
          ansible.builtin.apt:
            update_cache: true
        - name: Upgrade packages
          ansible.builtin.apt:
            upgrade: full
      when: ansible_pkg_mgr == 'apt'

    - name: Install and configure git
      block:
        # @todo Creation and copying of those files is not optimal. We can not account for changes
        # in the .gitconfig here. It would be better to either run `git config` OR have a custom `.gitconfig.custom`
        # and a file line check for .gitconfig.
        - name: Place config files in home directory
          ansible.builtin.copy:
            src: files/home/.gitconfig
            dest: ~/.gitconfig
            force: false # This file is very likely changed by the package installation

        - name: Place config files in home directory
          ansible.builtin.copy:
            src: "files/home/{{ item }}"
            dest: "~/{{ item }}"
          loop:
            - .gitconfig.github
            - .gitignore

        - name: Install git
          become: true
          ansible.builtin.package:
            name: git

    - name: Create needed directories in ~
      ansible.builtin.file:
        name: "~/{{ item }}"
        state: directory
      loop:
        - Projects
        - Projects/work

    - name: Install nerdfonts
      block:
        - name: Make .fonts directory
          ansible.builtin.file:
            dest: ~/.local/share/fonts/NerdFonts
            state: directory

        - name: Download nerdfont
          ansible.builtin.unarchive:
            remote_src: true
            src: https://github.com/ryanoasis/nerd-fonts/releases/download/v3.1.1/FiraMono.zip
            include:
              - FiraMonoNerdFontMono-Bold.otf
              - FiraMonoNerdFontMono-Medium.otf
              - FiraMonoNerdFontMono-Regular.otf
            dest: ~/.local/share/fonts/NerdFonts

    - name: Install starship
      ansible.builtin.debug:
        msg: This would install 'starship'
        # curl -sS https://starship.rs/install.sh | sh

    - name: Install IntelliJ IDEA Ultimate IDE
      ansible.builtin.debug:
        msg: This would install 'IntelliJ IDEA Ultimate IDE'
        # Possible collection: https://galaxy.ansible.com/ui/repo/published/diademiemi/jetbrains/
        # Place .desktop (~/.local/share/applications)

    # todo Maybe this is a base system thing?
    - name: Install Sublime Text
      ansible.builtin.debug:
        msg: This would install 'sublime text'
        # sudo rpm -v --import https://download.sublimetext.com/sublimehq-rpm-pub.gpg
        # sudo dnf config-manager --add-repo https://download.sublimetext.com/rpm/stable/x86_64/sublime-text.repo

    - name: Configure terminal
      block:
        - name: Find default profiles name
          ansible.builtin.command:
            cmd: gsettings get org.gnome.Terminal.ProfilesList default
          register: gnome_terminal_default_profile

        - name: Configure terminal
          block:
            # Maybe add a loop here with a check, so we do not run this every time.
            - name: Set nerdfont in default terminal profile
              ansible.builtin.command:
                cmd: "gsettings set {{gnome_terminal_default_profile_gsettings_path}}/ font 'Fira Mono 12'"
          vars:
            gnome_terminal_default_profile_gsettings_path: "org.gnome.Terminal.Legacy.Profile:/org/gnome/terminal/legacy/profiles:/:{{gnome_terminal_default_profile.stdout }}"

    - name: Configure shell
      ansible.builtin.debug:
        msg: This would configure the shell
        # - Install neofetch
        # - Place configs (dotfiles)

    - name: Install virtualbox
      ansible.builtin.debug:
        msg: This would install virtualbox

    - name: Install vagrant
      ansible.builtin.debug:
        msg: This would install vagrant

    - name: Install docker
      ansible.builtin.debug:
        msg: This would install docker

    - name: Install Insomnia (Flatpak)
      ansible.builtin.debug:
        msg: This would install Insomnia (Flatpak)
